<%
did = phoxy.GenerateUniqueID();

if (prio == null)
{
  ID = '';
  phoxy.Appeared('#' + did, function()
  {
    $(this).prop('disabled', 'true');
  });
}
phoxy.Appeared('#' + did, function()
{
  console.log(did);
  $(this)
    .change(function()
    {
      var that = $(this);
      that
        .prop('disabled', true);
      var db_id = $(this).attr('data-db-id');
      console.log('a');
      phoxy.AJAX(
        'alarm_prio/Update?id=' +
        db_id +
        '&val=' +
        that.val(), function(data)
        {
          that.prop('disabled', false);
          if (data.data.res)
          {
            that.tooltip({'title' : 'Сохранено'}).tooltip('show');
            phoxy.Defer(function() { that.tooltip('destroy'); }, 500);
          }
          else
          {
            that.tooltip({'title' : 'НЕ Сохранено'}).tooltip('show');
            that.css({'background-color' : 'red'});
            phoxy.Defer(function() { that.tooltip('destroy'); }, 1000);
            phoxy.Defer(function() { that.css({'background-color' : 'white'}); }, 2000);
          }
        });
    });
});
%>

<input
  id='<%= did %>'
  data-db-id='<%= ID %>'
  type='text'
  value='<%= prio %>'
  class="form-control"
  >
